
@{
    ViewData["Title"] = "Product";
}

@model PaginatedList<Clothing_Store.Models.ProductViewModel>

<!-- All Products -->
<div class="container __section">
    <div class="row">
        <div class="mb-3 col-12 col-sm-3 __category-block">
            <div class="card bg-light mb-3">
                <div class="card-header text-uppercase py-3 text-center __category-block-title">DANH MỤC SẢN PHẨM</div>
                <ul class="list-group category_block">
                    <li class="list-group-item px-5 py-3"><a asp-action="Index" asp-route-searchByName="@ViewBag.searchByName" asp-route-filter="Áo thun nam" asp-route-sortBy="@ViewBag.sortBy" >Áo thun nam</a></li>
                    <li class="list-group-item px-5 py-3"><a asp-action="Index" asp-route-searchByName="@ViewBag.searchByName" asp-route-filter="Áo khoác nam" asp-route-sortBy="@ViewBag.sortBy" >Áo khoác nam</a></li>
                    <li class="list-group-item px-5 py-3"><a asp-action="Index" asp-route-searchByName="@ViewBag.searchByName" asp-route-filter="Áo thun nam" asp-route-sortBy="@ViewBag.sortBy" >Áo thun nữ</a></li>
                    <li class="list-group-item px-5 py-3"><a asp-action="Index" asp-route-searchByName="@ViewBag.searchByName" asp-route-filter="Áo khoác nữ" asp-route-sortBy="@ViewBag.sortBy" >Áo khoác nữ</a></li>
                    <li class="list-group-item px-5 py-3"><a asp-action="Index" asp-route-searchByName="@ViewBag.searchByName" asp-route-filter="Áo sơ mi"asp-route-sortBy="@ViewBag.sortBy" >Áo sơ mi</a></li>
                </ul>
            </div>

            <div>
                <form asp-action="Index" method="get">
                    <div class="form-actions no-color row">
                        <div class="col-8">
                            <input class="_form-input" type="text" name="searchByName" value="@ViewBag.currentSearch" placeholder="Tìm kiếm theo tên"/>
                        </div>
                        <div class="col-4">
                            <button  type="submit" class="_btn"> Tìm </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="col">
            <div class="row">
                <section class="__all-products" id="products">
                    <div class="__top">
                        <h1>Tất cả sản phẩm</h1>
                        <select name="sortBy" id="sortBy">
                            <!option value="name_asc" @(ViewBag.SortBy == "name_asc" ? "selected" : "")>
                                Tên: A đến Z
                            </!option>
                            <!option value="name_desc" @(ViewBag.SortBy == "name_desc" ? "selected" : "")>
                                Tên: Z đến A
                            </!option>
                            <!option value="price_asc" @(ViewBag.SortBy == "price_asc" ? "selected" : "")>
                                Giá: Thấp đến Cao
                            </!option>
                            <!option value="price_desc" @(ViewBag.SortBy == "price_desc" ? "selected" : "")>
                                Giá: Cao đến Thấp
                            </!option>
                            <!option value="rating_asc" @(ViewBag.SortBy == "rating_asc" ? "selected" : "")>
                                Đánh giá: Thấp đến Cao
                            </!option>
                            <!option value="rating_desc" @(ViewBag.SortBy == "rating_desc" ? "selected" : "")>
                                Đánh giá: Cao đến Thấp
                            </!option>
                            <span><i class='bx bx-chevron-down'></i></span>
                        </select>
                    </div>

                    <div class="__product-center">

                        @foreach (ProductViewModel item in Model)
                        {
                            <div class="__product">
                                <div class="__product-header">
                                    <img src="@item.image.URL" alt="@item.image.Name">
                                    <ul class="icons">
                                        <span><i class="bx bx-shopping-bag"></i></span>
                                        <span><i class="bx bx-search"></i></span>
                                    </ul>
                                </div>
                                <div class="__product-footer">
                                    <a asp-controller="Product" asp-action="Details" asp-route-id="@item.ID">
                                        <h3>@item.Name</h3>
                                    </a>
                                    <div class="__rating">
                                        @for (int i = 0; i < item.ratings; i++)
                                        {
                                            <i class="bx bxs-star"></i>
                                        }

                                        @for (int i = 0; i < 5 - item.ratings; i++)
                                        {
                                            <i class="bx bx-star"></i>
                                        }
                                    </div>
                                    <h4 class="__price">@item.Price</h4>
                                </div>
                            </div>
                        }

                    </div>
                    <div class="__pagination">
                        <div class="">
                            @if (Model.PageIndex != 1)
                            {
                                <a asp-action="Index"
                                   asp-route-currentSearch="@ViewBag.currentSearch"
                                   asp-route-filter="@ViewBag.filter"
                                   asp-route-page="@(Model.PageIndex - 1)"
                                   asp-route-sortBy="@ViewBag.sortBy"
                                   class="btn shadow-none p-0">
                                    <span>
                                        <i class='bx bx-left-arrow-alt'></i>
                                    </span>
                                </a>
                            }
                            @{
                                int rank = Model.PageIndex % 5 == 0 ? Model.PageIndex / 5 - 1 : Model.PageIndex / 5;
                            }
                            @for (int i = 1; i <= 5; i++)
                            {
                                if (Model.TotalPages != 1)
                                {
                                    int pageNumber = i + (rank * 5);
                                    if (pageNumber - 1 == Model.TotalPages) break;
                                    <a asp-action="Index"
                                       asp-route-currentSearch="@ViewBag.currentSearch"
                                       asp-route-filter="@ViewBag.filter"
                                       asp-route-page="@pageNumber"
                                       asp-route-sortBy="@ViewBag.sortBy"
                                       class="btn shadow-none p-0 @(pageNumber == Model.PageIndex ? "disabled" : "")">
                                        <span>
                                            @pageNumber
                                        </span>
                                    </a>
                                }
                            }
                            @if (Model.PageIndex != Model.TotalPages)
                            {
                                <a asp-action="Index"
                                   asp-route-currentSearch="@ViewBag.currentSearch"
                                   asp-route-filter="@ViewBag.filter"
                                   asp-route-page="@(Model.PageIndex + 1)"
                                   asp-route-sortBy="@ViewBag.sortBy"
                                   class="btn shadow-none p-0">
                                    <span>
                                        <i class='bx bx-right-arrow-alt'></i>
                                    </span>
                                </a>
                            }
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>



